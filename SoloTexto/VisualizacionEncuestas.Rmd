---
title: "Visualización de encuestas presidenciales"
author: "Raul Eyzaguirre"
date: "01 de enero del 2016"
output: html_document
---

¿Cómo interpretar los resultados de una encuesta presidencial? Cualquier resultado obtenido a partir de una muestra tiene un margen de error. Eventualmente los medios de comunicación indican el margen de error y mencionan algo sobre cierto nivel de confianza, pero estos datos suelen ser incomprendidos por la mayoría. ¿Por qué hay un margen de error? Pues porque los números que se muestran son el resultado de una encuesta en la que solo se ha consultado a una pequeña parte de la población. Suponga por ejemplo que usted toma una muestra al azar de 100 personas y que en esa muestra encuentra que 30 tienen intención de votar por el candidato A. Entonces puede decir que el 30% de su muestra piensa votar por A, pero eso no quiere decir que el 30% de la población vaya a votar por A, y tampoco quiere decir que en otra muestra de 100 nuevamente 30 vayan a indicar que piensan votar por A. Si se sacaran muchas muestras de tamaño 100, en cada muestra se podrían obtener resultados distintos a favor de A; quizá 30 en algunas, 28 en otras, o 29, 33, 32 o 25, en fin, números distintos pero que, si se hicieron bien las cosas en el muestreo, debieran estar todos ellos alrededor de la intención de voto poblacional (lo que se observa finalmente el día de las elecciones), desconocida, a favor de dicho candidato. Esta variabilidad de muestra a muestra es la que tiene que ver con el margen de error.

¿Cómo visualizar entonces el resultado de una encuesta junto con su correspondiente margen de error? Una forma es calcular un intervalo de confianza. Otra forma, y la que me permito mostrar aquí, podría ser mostrando una posible distribución de los resultados que podrían obtenerse si se repitiera la encuesta muchas veces, en el supuesto, claro está, de que la única encuesta que sí se hizo, se hizo bien. La idea es, a partir de los resultados de la encuesta que sí se hizo, simular resultados de otras posibles encuestas para poder visualizar el famoso margen de error. Los resultados de estas simulaciones se pueden graficar de varias maneras: en este caso he escogido un gráfico de puntos. Abajo puede ver los resultados obtenidos con la simulación de 1000 encuestas. Las abreviaturas usadas en los gráficos son las siguientes:

* AB: Alfredo Barnechea
* AF: Antero Flores
* AG: Alan García
* AT: Alejandro Toledo
* CA: César Acuña
* DU: Daniel Urresti
* FO: Fernando Olivera
* GS: Gregorio Santos
* JG: Julio Guzmán
* KF: Keiko Fujimori
* MH: Miguel Hilario
* NGG: Nano Guerra García
* PPK: Pedro Pablo Kuczynski
* RB: Ricardo Belmont
* VC: Vladimir Cerrón
* VM: Verónika Mendoza
* YS: Yehude Simon 

```{r}
library(ggplot2)

set.seed(1)

sims <- function(y, n){
  x <- t(array(rgamma(n * 1000, y, 1), c(n, 1000)))
  p <- x / apply(x, 1, sum) * 100
  p <- sapply(t(p[, 1:(n - 1)]), c)
}

gg <- function(datos, candidato, p){
  ggplot(datos, aes(candidato, p), xlab = "Candidato", ylab = "Intención de voto (%)") +
    geom_jitter(width = 0.1, aes(color = candidato), alpha = I(0.05)) +
    theme(legend.position = "none")
}
```

[Encuesta nacional urbano rural de GFK - Encuestas del 11 al 15 de Diciembre del 2015](http://www.gfk.com/fileadmin/user_upload/dyna_content/PE/GfK_OP_Diciembre_2015_-_Gobierno_y_Lima.pdf)

```{r fig.height=6, fig.width=10}
y <- c(380, 139, 101, 63, 38, 25, 25, 25, 8, 5, 3, 3, 452)
p <- sims(y, length(y))
candidato <- c("KF", "PPK", "CA", "AG", "AT", "JG", "DU", "VM", "NGG", "RB", "AF", "MH")
candidato <- factor(candidato, levels = candidato)
datos <- data.frame(p = p, candidato = candidato)
gg(datos, candidato, p)
```

[Encuesta nacional urbano rural de Ipsos - Encuestas del 12 al 14 de enero del 2016](http://www.ipsos.pe/sites/default/files/opinion_data/Opinion%20Data%20Enero%202016.pdf)

```{r fig.height=6, fig.width=10}
y <- c(604, 238, 238, 146, 92, 55, 37, 37, 37, 347)
p <- sims(y, length(y))
candidato <- c("KF", "CA", "PPK", "AG", "JG", "AT", "VM", "DU", "NGG")
candidato <- factor(candidato, levels = candidato)
datos <- data.frame(p = p, candidato = candidato)
gg(datos, candidato, p)
```

[Encuesta nacional urbano rural de GFK - Encuestas del 22 al 26 de enero del 2016](http://www.gfk.com/fileadmin/user_upload/dyna_content/PE/GfK_OP_Enero_2016_-_Gobierno_y_Lima.pdf)

```{r fig.height=6, fig.width=10}
y <- c(510, 163, 156, 148, 102, 42, 30, 14, 9, 8, 6, 5, 2, 2, 366)
p <- sims(y, length(y))
candidato <- c("KF", "JG", "CA", "PPK", "AG", "AT", "VM", "DU", "GS", "AB", "VC",
               "NGG", "AF", "YS")
candidato <- factor(candidato, levels = candidato)
datos <- data.frame(p = p, candidato = candidato)
gg(datos, candidato, p)
```

[Simulacro de votación de Datum - Encuestas del 5 al 8 de febrero del 2016](http://cde.peru21.pe/ima/0/0/3/5/2/352448.jpg)

```{r fig.height=6, fig.width=10}
y <- c(375, 193, 133, 85, 48, 36, 24, 24, 12, 12, 12, 5, 2, 1, 1, 1, 245)
p <- sims(y, length(y))
candidato <- c("KF", "JG", "PPK", "CA", "AG", "AB", "VM", "AT", "DU", "NGG", "GS", "FO",
               "VC", "MH", "AF", "YS")
candidato <- factor(candidato, levels = candidato)
datos <- data.frame(p = p, candidato = candidato)
gg(datos, candidato, p)
```

[Encuesta nacional urbano rural de Ipsos - Encuestas del 13 al 18 de febrero del 2016](http://rpp.pe/politica/elecciones/ipsos-keiko-fujimori-baja-3-puntos-y-julio-guzman-se-consolida-como-segundo-noticia-939875)

```{r fig.height=6, fig.width=10}
y <- c(545, 327, 163, 109, 91, 73, 73, 36, 398)
p <- sims(y, length(y))
candidato <- c("KF", "JG", "PPK", "CA", "AG", "AB", "VM", "AT")
candidato <- factor(candidato, levels = candidato)
datos <- data.frame(p = p, candidato = candidato)
gg(datos, candidato, p)
```
